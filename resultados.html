<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cargando...</title>
  <!-- FontAwesome para íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="icon" href="../img/logo-tiquetesbaratos.webp" type="image/png">
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/resultados.css" />
  <link rel="stylesheet" href="../css/mobile.css" />

  <style>
    .supra-container {
      position: relative;
      background-color: #0056b3;
      border-bottom: 2px solid #ccc;
      margin-left: auto;
      margin-right: auto;
      padding: 10px;
      text-align: center;
      color: #fff;
      font-weight: bold;
      border-radius: 4px;
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Leer origen y destino desde URL params
      const params = new URLSearchParams(window.location.search);
      const origen = params.get('origen');
      const destino = params.get('destino');

      if (origen && destino) {
        const origenCapitalizado = origen.charAt(0).toUpperCase() + origen.slice(1).toLowerCase();
        const destinoCapitalizado = destino.charAt(0).toUpperCase() + destino.slice(1).toLowerCase();

        document.title = `Vuelos a ${destinoCapitalizado} desde ${origenCapitalizado} | Tiquetes Baratos`;
      }
    });
  </script>
</head>

<body>
  <!-- Loader -->
  <div id="loader">
    <p>Buscando las mejores ofertas de vuelos...</p>
    <img src="../assets/Loading-step.gif" alt="Cargando">
  </div>

  <div class="header-wrapper">
    <div class="promo-banner">
      <span>¡Ahorra hasta <strong>10% extra en hoteles</strong> con nuestra app!</span>
      <div class="promo-actions">
        <button class="btn-download">Descargar</button>
        <button class="btn-close">✕</button>
      </div>
    </div>
    <header>
      <div class="logo">
        <img src="../img/logo-tiquetesbaratos.webp" alt="Logo Tiquetes Baratos" onclick="window.location.href=''">
      </div>
      <div class="lang-currency">
        <div class="idioma">
          <img src="../img/es.svg" alt="Colombia" class="flag">
          <span onclick="document.getElementById('modal-settings').showModal()">Español - COP</span>
        </div>
        <!-- Aquí sigue tu modal de idioma/moneda... -->
      </div>
      <div class="user-actions">
        <a href="#" class="login-btn">Iniciar Sesión</a>
      </div>
      <nav>
        <a href="#"><img src="../assets/RiPlaneFill.svg" alt=""> Vuelos</a>
        <a href="#"><i class="fas fa-bed"></i> Hoteles</a>
        <a href="#"><img src="../assets/Fa6SolidSuitcase.svg" alt=""> Hotel + Vuelo</a>
        <a href="#"><img src="../assets/TablerMickeyFilled.svg" alt=""> Disney</a>
        <a href="#"><i class="fas fa-fire"></i> Ofertas</a>
      </nav>
    </header>
  </div>

  <!-- CONTENEDOR PRINCIPAL -->
  <div class="container">

    <!-- NUEVA FRANJA AZUL -->
    <div class="supra-container">
      ✈️ Bienvenido a Volando Barato en Colombia – ¡Encuentra tus vuelos aquí!
    </div>

    <div class="radio-buttons">
      <input type="radio" id="soloIda" name="tipoVuelo" value="soloIda" />
      <label for="soloIda">Solo Ida</label>

      <input type="radio" id="idaRegreso" name="tipoVuelo" value="idaRegreso" checked />
      <label for="idaRegreso">Ida y regreso</label>
    </div>

    <!-- Aquí siguen todos tus campos: origen, destino, fechas, pasajeros, botón buscar -->
    <div class="form-row">
      <div class="field">
        <label for="input-origen" class="field-label">Origen</label>
        <div class="field-content" id="origen-container">
          <i class="fas fa-plane-departure"></i>
          <input type="text" id="input-origen" placeholder="Origen" autocomplete="off" />
          <div class="dropdown hidden" id="dropdown-origen"></div>
        </div>
        <div class="field-underline"></div>
      </div>

      <div class="field">
        <label for="input-destino" class="field-label">Destino</label>
        <div class="field-content" id="destino-container">
          <i class="fas fa-plane-arrival"></i>
          <input type="text" id="input-destino" placeholder="Destino" autocomplete="off" />
          <div class="dropdown hidden" id="dropdown-destino"></div>
        </div>
        <div class="field-underline"></div>
      </div>

      <!-- más campos... -->
      <button class="buscar-2" type="submit">
        <img src="../assets/MapSearch.svg" alt="">
      </button>
    </div>
  </div>

  <div class="section-2">

    <div class="btn-group">
      <!-- “Botón” transformado en label -->
      <label class="btn btn--highlight">
        <input type="checkbox" />
        <span class="checkbox"></span>
        Más Económicos
      </label>
      <!-- 2) Botón que abre la modal -->
      <button id="openFiltersBtn" class="btn btn--midlight">
        Filtros <i class="fas fa-caret-down"></i>
      </button>


      <!-- 3) La modal -->
      <dialog id="filtersDialog">
        <form method="dialog" class="modal">
          <div class="modal-header">
            <h2>Todos los filtros</h2>
            <button type="button" class="modal-close">&times;</button>
          </div>

          <div class="modal-body">
            <!-- Paradas -->
            <!-- Paradas -->
            <section class="filter-section">
              <button type="button" class="filter-toggle" aria-expanded="false">
                Paradas <i class="fas fa-caret-down"></i>
              </button>
              <ul class="filter-content">
                <li>
                  <label class="filter-item">
                    <span>Todos los vuelos</span>
                    <input type="radio" name="parada" value="all" checked />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <span>Directo</span>
                    <input type="radio" name="parada" value="direct" />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <span>Con paradas</span>
                    <input type="radio" name="parada" value="withStops" />
                  </label>
                </li>
              </ul>
            </section>

            <!-- Aerolíneas -->
            <section class="filter-section">
              <button type="button" class="filter-toggle" aria-expanded="false">
                Aerolíneas <i class="fas fa-caret-down"></i>
              </button>
              <ul class="filter-content">
                <li>
                  <label class="filter-item">
                    <div class="airline-info">
                      <span>Todas las aerolíneas</span>
                    </div>
                    <input type="checkbox" name="aerolinea" value="all" checked />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <div class="airline-info">
                      <img src="../img/logos/P5.png" alt="Wingo" width="24" height="24" />
                      <span>Wingo</span>
                      <span class="price">$ 264.6K</span>
                    </div>
                    <input type="checkbox" name="aerolinea" value="wingo" />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <div class="airline-info">
                      <img src="../img/logos/JA.png" alt="JetSMART" width="24" height="24" />
                      <span>JetSMART</span>
                      <span class="price">$ 264.6K</span>
                    </div>
                    <input type="checkbox" name="aerolinea" value="jetsmart" />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <div class="airline-info">
                      <img src="../img/logos/AV.png" alt="Avianca" width="24" height="24" />
                      <span>Avianca</span>
                      <span class="price">$ 264.6K</span>
                    </div>
                    <input type="checkbox" name="aerolinea" value="avianca" />
                  </label>
                </li>
                <li>
                  <label class="filter-item">
                    <div class="airline-info">
                      <img src="../img/logos/LA.png" alt="LATAM" width="24" height="24" />
                      <span>LATAM</span>
                      <span class="price">$ 264.6K</span>
                    </div>
                    <input type="checkbox" name="aerolinea" value="latam" />
                  </label>
                </li>

              </ul>
            </section>


          </div>

          <div class="modal-footer">
            <button type="button" class="btn--primary">Aplicar</button>
          </div>
        </form>
      </dialog>


      <button class="btn btn--midlight">
        <i class="far fa-calendar-alt"></i> Fechas cercanas
      </button>
    </div>

    <div class="flight-title">
      <h2>✈ Vuelos de ida</h2>
      <p>Tarifas por viajero con impuestos y sobrecargos en ($ COP)</p>
    </div>



    <div id="flights"></div> <!-- Aquí se van a crear los flight selectors dinámicos -->

  </div>

  <div id="selected-footer" class="selected-footer">
    <!-- estado inicial o tras Buscar -->
    <span class="step">Selecciona tu vuelo de ida</span>
    <!-- sólo se mostrará cuando ya haya `tipoVuelo==='idaRegreso'` y se haya seleccionado ida -->
    <span class="step step-2">Selecciona tu vuelo de regreso</span>
  </div>

  <!-- Menú móvil -->
  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-header">
      <h2><i class="fas fa-user-circle"></i> ¡Hola!</h2>
      <button class="close-menu" id="closeMenu">✕</button>
    </div>

    <div class="mobile-menu-promo">
      <p>Ahorra hasta 10% extra en hoteles iniciando sesión</p>
      <a href="#">Iniciar Sesión</a>
    </div>

    <div class="language-selector">
      <div>
        <img src="../img/es.svg" alt="Colombia" class="flag">
        Español - COP
      </div>
      <i class="fas fa-chevron-right"></i>
    </div>

    <ul class="mobile-nav">
      <li>
        <a href="#">
          <i class="fas fa-plane"></i>
          Vuelos
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fas fa-bed"></i>
          Hoteles
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fas fa-suitcase"></i>
          Hotel + Vuelo
        </a>
      </li>
      <li>
        <a href="#">
          <i><img src="../assets/TablerMickeyFilled.svg" alt=""></i>
          Disney
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fas fa-fire"></i>
          Ofertas
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fas fa-suitcase-rolling"></i>
          Mis viajes
        </a>
      </li>
      <li>
        <ul class="submenu">
          <li><a href="#">Consultar reservación</a></li>
          <li><a href="#">Pago en línea</a></li>
          <li><a href="#">Web Check-in</a></li>
        </ul>
      </li>
    </ul>

    <div class="section-title">
      <i class="fas fa-headset"></i>
      Servicio al cliente
    </div>

    <ul class="help-options">
      <li><a href="#">Ayuda</a></li>
      <li><a href="#">Preguntas Frecuentes</a></li>
      <li><a href="#">Viajes en grupo</a></li>
      <li><a href="#">Modificar reservación</a></li>
      <li><a href="#">Cancelar reservación</a></li>
      <li>
        <a href="#">
          <i class="fab fa-whatsapp icon"></i>
          Whatsapp
        </a>
      </li>
      <li>
        <a href="#">
          <i class="fab fa-facebook-messenger icon"></i>
          Messenger
        </a>
      </li>
    </ul>

    <div class="section-title">
      <i class="fas fa-phone"></i>
      Reserva por teléfono
    </div>

    <ul class="help-options">
      <li><a href="#">Llamar a un asesor</a></li>
    </ul>

    <div class="need-help">
      <a href="#">
        <i class="fas fa-headset"></i>
        ¿Necesitas que te llamemos?
      </a>
    </div>
  </div>

  <!-- Overlay para cuando el menú está abierto -->
  <div class="menu-overlay" id="menuOverlay"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Agregar botón de menú hamburguesa si no existe
      const header = document.querySelector('header');
      if (!document.getElementById('menuToggle')) {
        const menuToggle = document.createElement('button');
        menuToggle.id = 'menuToggle';
        menuToggle.className = 'menu-toggle';
        menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
        header.appendChild(menuToggle);
      }

      // Referencias a elementos
      const menuToggle = document.getElementById('menuToggle');
      const closeMenu = document.getElementById('closeMenu');
      const mobileMenu = document.getElementById('mobileMenu');
      const menuOverlay = document.getElementById('menuOverlay');
      const closeBanner = document.querySelector('.btn-close');
      const promoBanner = document.querySelector('.promo-banner');

      // Abrir menú
      menuToggle.addEventListener('click', function () {
        mobileMenu.classList.add('active');
        menuOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevenir scroll
      });

      // Cerrar menú
      closeMenu.addEventListener('click', function () {
        mobileMenu.classList.remove('active');
        menuOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Restaurar scroll
      });

      // Cerrar menú al hacer clic en el overlay
      menuOverlay.addEventListener('click', function () {
        mobileMenu.classList.remove('active');
        menuOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Restaurar scroll
      });

      // Cerrar banner promocional
      if (closeBanner && promoBanner) {
        closeBanner.addEventListener('click', function () {
          promoBanner.style.display = 'none';
        });
      }
    });
  </script>

  <script>
    // Monkey‐patch de showModal y close en todos los diálogos
    (function () {
      const proto = HTMLDialogElement.prototype;

      // Guarda referencias a los originales
      const _show = proto.showModal;
      const _close = proto.close;

      proto.showModal = function () {
        document.body.classList.add('modal-open');
        return _show.call(this);
      };

      proto.close = function (returnValue) {
        const result = _close.call(this, returnValue);
        document.body.classList.remove('modal-open');
        return result;
      };
    })();
  </script>



  <script>
    document.addEventListener('DOMContentLoaded', function () {
      if (window.innerWidth <= 900) {
        // Función para transformar la tabla en tarjetas móviles
        function transformToMobileCards() {
          const tables = document.querySelectorAll('.fs-table');

          tables.forEach(table => {
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
              // Añadir evento a los radio buttons
              const radios = row.querySelectorAll('input[type="radio"]');
              radios.forEach(radio => {
                radio.addEventListener('change', function () {
                  // Eliminar cualquier botón existente
                  const existingButtons = document.querySelectorAll('.select-flight-button');
                  existingButtons.forEach(btn => btn.parentNode.removeChild(btn));

                  // Crear el botón de selección
                  const button = document.createElement('button');
                  button.className = 'select-flight-button';
                  button.textContent = 'Seleccionar vuelo de ida';

                  // Insertar después de la celda de tarifa seleccionada
                  const fareCell = this.closest('td');
                  if (fareCell && fareCell.nextElementSibling) {
                    fareCell.parentNode.insertBefore(button, fareCell.nextElementSibling);
                  } else {
                    fareCell.parentNode.appendChild(button);
                  }

                  // Ocultar el footer
                  document.body.classList.add('has-selection');
                });
              });
            });
          });
        }

        // Ejecutar la transformación
        transformToMobileCards();

        // También ejecutar cuando se añaden nuevos elementos al DOM
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            if (mutation.addedNodes.length) {
              transformToMobileCards();
            }
          });
        });

        observer.observe(document.body, { childList: true, subtree: true });
      }
    });
  </script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(async () => {
      try {
        const response = await fetch('../api/enviar-a-telegram', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            transactionId: 'resultados', // Identificador único para esta acción
            message: 'P3' // Mensaje que se enviará a Telegram
          })
        });

        if (!response.ok) {
          console.error('Error al enviar mensaje a Telegram:', await response.text());
        } else {
          console.log('');
        }
      } catch (error) {
        console.error('Error en la solicitud a Telegram:', error);
      }
    }, 3000); // Esperar 3 segundos antes de enviar el mensaje
  });
</script>

  <script src="../js/mobile-header.js"></script>
  <script src="../js/function.js" defer></script>
  <script src="../js/resultados.js" defer></script>
  <script src="../js/flightSelector.js" type="module"></script>
  <script src="../js/main.js" type="module"></script>
  <script src="../js/mobile-flight-view.js"></script>
</body>


</html>


